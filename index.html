<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Pomodoro</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --frame: #181718;
      --accent: #3b82f6;
      --accent-soft: rgba(59, 130, 246, 0.15);
      --text: #e5e7eb;
      --text-soft: #9ca3af;
      --radius-xl: 18px;
      --radius-lg: 12px;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }

    body {
      background: #181718;
      color: var(--text);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 6px;
    }

    .app {
      width: 100%;
      max-width: 420px;
      background: transparent;
      border-radius: 20px;
      padding: 0;
      border: none;
    }

    /* TARJETA PRINCIPAL SIN BORDES */
    .timer-card {
      background: linear-gradient(
        145deg,
        #020617 0%,
        #020617 12%,
        #0b1120 45%,
        #1d4ed8 100%
      );
      border-radius: 18px;
      padding: 10px 14px 10px;
      border: none !important;
    }

    /* Fila superior */
    .timer-top {
      display: grid;
      grid-template-columns: auto 1fr auto;
      align-items: center;
      margin-bottom: 8px;
      column-gap: 10px;
    }

    .timer-left {
      display: flex;
      gap: 4px;
    }

    .icon-btn {
      width: 24px;
      height: 24px;
      border-radius: 6px;
      background: #0f1e44;
      border: 1px solid #1d4ed8;
      color: #93c5fd;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 13px;
      cursor: pointer;
      transition: background 0.15s ease, color 0.15s ease;
      box-shadow: none !important;
    }

    .icon-btn:hover {
      background: #1e3a8a;
      color: #ffffff;
    }

    .session-counter {
      font-size: 11px;
      color: var(--text-soft);
      text-align: center;
      width: 100%;
    }

    .timer-label {
      font-size: 11px;
      color: var(--text-soft);
      text-align: right;
      white-space: nowrap;
    }

    .timer-display {
      font-size: 40px;
      font-weight: 600;
      text-align: center;
      margin: 2px 0;
    }

    .timer-status {
      font-size: 10px;
      text-align: center;
      color: var(--text-soft);
      margin-bottom: 6px;
    }

    .progress-bar {
      width: 100%;
      height: 4px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.8);
      margin-bottom: 6px;
      overflow: hidden;
    }

    .progress-fill {
      height: 100%;
      width: 100%;
      transform-origin: left;
      transform: scaleX(1);
      background: linear-gradient(90deg, #22c55e, #3b82f6);
    }

    .controls {
      display: flex;
      gap: 6px;
      margin-bottom: 2px;
    }

    .btn {
      flex: 1;
      height: 32px;
      border-radius: 999px;
      font-size: 12px;
      border: none;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 4px;
      padding: 0 10px;
    }

    .btn-primary {
      background: var(--accent);
      color: #0d1117;
    }

    .btn-secondary {
      background: #020617;
      color: var(--text-soft);
      border: 1px solid #1f2937;
    }

    /* Popup ajustes */
    .settings-modal {
      position: absolute;
      inset: 0;
      background: rgba(0,0,0,0.5);
      display: none;
      align-items: center;
      justify-content: center;
    }

    .settings-modal.open {
      display: flex;
    }

    .settings-modal-content {
      background: #020617;
      padding: 12px 14px;
      border-radius: 14px;
      width: 100%;
      max-width: 260px;
      border: 1px solid rgba(148,163,184,0.4);
    }

    .settings-modal-content h4 {
      margin-bottom: 6px;
      color: #e5e7eb;
      font-size: 13px;
    }

    .settings-input {
      width: 100%;
      margin-top: 3px;
      margin-bottom: 6px;
      padding: 5px;
      border-radius: 8px;
      background: #0f172a;
      border: 1px solid #1f2937;
      color: white;
      text-align: center;
      font-size: 12px;
    }

    .settings-toggle {
      margin-top: 4px;
      font-size: 11px;
      color: var(--text-soft);
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .settings-toggle input {
      accent-color: var(--accent);
    }
  </style>
</head>

<body>

  <div class="app">

    <section class="timer-card">

      <div class="timer-top">
        <div class="timer-left">
          <button class="icon-btn" id="btn-next">▶▶</button>
          <button class="icon-btn" id="btn-config">⚙</button>
        </div>

        <div class="session-counter" id="session-counter">
          Pomodoros completados: 0
        </div>

        <div class="timer-label" id="mode-label">Sesión de trabajo</div>
      </div>

      <div class="timer-display" id="timer-display">25:00</div>
      <div class="timer-status" id="timer-status">Listo para comenzar</div>

      <div class="progress-bar">
        <div class="progress-fill" id="progress-fill"></div>
      </div>

      <div class="controls">
        <button class="btn btn-primary" id="btn-toggle">▶ Iniciar</button>
        <button class="btn btn-secondary" id="btn-reset">↺ Reiniciar</button>
      </div>

      <!-- Popup Ajustes -->
      <div class="settings-modal" id="settings-modal">
        <div class="settings-modal-content">
          <h4>Ajustes de duración</h4>

          <label>Trabajo (min)
            <input class="settings-input" type="number" id="focus-min" value="25">
          </label>

          <label>Pausa corta (min)
            <input class="settings-input" type="number" id="short-min" value="5">
          </label>

          <label>Pausa larga (min)
            <input class="settings-input" type="number" id="long-min" value="15">
          </label>

          <div class="settings-toggle">
            <label>
              <input type="checkbox" id="auto-continue" checked />
              Auto pasar a la siguiente fase
            </label>
          </div>
        </div>
      </div>

    </section>
  </div>

<script>
  const MODES = {
    focus: { label:"Sesión de trabajo" },
    short: { label:"Pausa corta" },
    long:  { label:"Pausa larga" }
  };

  const modesOrder = ["focus","short","long"];

  const modeLabel      = document.getElementById("mode-label");
  const sessionCounter = document.getElementById("session-counter");
  const displayEl      = document.getElementById("timer-display");
  const statusEl       = document.getElementById("timer-status");
  const progressFill   = document.getElementById("progress-fill");
  const btnToggle      = document.getElementById("btn-toggle");
  const btnReset       = document.getElementById("btn-reset");
  const nextBtn        = document.getElementById("btn-next");
  const configBtn      = document.getElementById("btn-config");
  const settingsModal  = document.getElementById("settings-modal");
  const focusInput     = document.getElementById("focus-min");
  const shortInput     = document.getElementById("short-min");
  const longInput      = document.getElementById("long-min");
  const autoContinueCb = document.getElementById("auto-continue");

  let currentMode = "focus";
  let totalSeconds = 25 * 60;
  let remainingSeconds = totalSeconds;
  let timerId = null;
  let isRunning = false;
  let completedPomodoros = 0;
  let autoContinueEnabled = true;  // ahora configurable

  /* SONIDO PERSONALIZADO */
  const beepAudio = new Audio("pomodoro-beep.mp3");
  beepAudio.volume = 1.0;

  function playBeep() {
    try {
      beepAudio.currentTime = 0;
      beepAudio.play().catch(()=>{});
    } catch(e) {}
  }

  function setMode(mode){
    currentMode = mode;

    let m =
      mode === "focus" ? Number(focusInput.value || 25) :
      mode === "short" ? Number(shortInput.value || 5) :
                         Number(longInput.value || 15);

    if (m < 1) m = 1;

    totalSeconds = m * 60;
    remainingSeconds = totalSeconds;

    modeLabel.textContent = MODES[mode].label;
    statusEl.textContent = "Listo para comenzar";
    updateDisplay();
  }

  function updateDisplay(){
    const m = Math.floor(remainingSeconds / 60);
    const s = remainingSeconds % 60;

    displayEl.textContent =
      (m<10?"0":"")+m+":"+(s<10?"0":"")+s;

    const ratio = totalSeconds > 0
      ? remainingSeconds / totalSeconds
      : 0;

    progressFill.style.transform = "scaleX(" + ratio + ")";
  }

  function startTimer(){
    if(isRunning) return;

    isRunning = true;
    btnToggle.textContent = "⏸ Pausar";
    statusEl.textContent = "En curso...";

    timerId = setInterval(()=>{
      remainingSeconds--;

      if(remainingSeconds <= 0){
        clearInterval(timerId);
        isRunning = false;
        remainingSeconds = 0;

        updateDisplay();
        statusEl.textContent = "¡Tiempo cumplido!";
        playBeep();

        if(currentMode === "focus"){
          completedPomodoros++;
          sessionCounter.textContent =
            "Pomodoros completados: " + completedPomodoros;
        }

        if(autoContinueEnabled){
          if(currentMode === "focus") setMode("short");
          else setMode("focus");
          startTimer();
        }
        return;
      }

      updateDisplay();
    }, 1000);
  }

  function pauseTimer(){
    clearInterval(timerId);
    isRunning = false;
    btnToggle.textContent = "▶ Reanudar";
    statusEl.textContent = "Pausado";
  }

  function resetTimer(){
    clearInterval(timerId);
    isRunning = false;
    btnToggle.textContent = "▶ Iniciar";
    setMode(currentMode);
  }

  btnToggle.onclick = () => {
    if(isRunning) pauseTimer();
    else startTimer();
  };

  btnReset.onclick = () => resetTimer();

  nextBtn.onclick = () => {
    const index = modesOrder.indexOf(currentMode);
    const nextMode = modesOrder[(index + 1) % modesOrder.length];
    resetTimer();
    setMode(nextMode);
  };

  configBtn.onclick = () => {
    settingsModal.classList.toggle("open");
  };

  settingsModal.onclick = (e) => {
    if(e.target === settingsModal){
      settingsModal.classList.remove("open");
    }
  };

  [focusInput, shortInput, longInput].forEach(inp => {
    inp.addEventListener("change", () => {
      if(inp.value < 1) inp.value = 1;
      setMode(currentMode);
    });
  });

  // Toggle para auto continuar
  autoContinueCb.addEventListener("change", () => {
    autoContinueEnabled = autoContinueCb.checked;
  });

  // Estado inicial
  autoContinueEnabled = autoContinueCb.checked;
  setMode("focus");
</script>

</body>
</html>
